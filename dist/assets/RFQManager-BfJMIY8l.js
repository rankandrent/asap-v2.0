import{r as d,j as e,B as o}from"./index-BaYg4v0E.js";import{g as D,a as _,u as C}from"./rfqQueries-HiUeWbzr.js";import{C as l,a as n,b as r,c}from"./card-B7NPPkN6.js";import{B as g}from"./badge-C-xAuew-.js";function A(){const[m,N]=d.useState([]),[t,f]=d.useState(null),[b,u]=d.useState(!0),[x,v]=d.useState("all"),[i,w]=d.useState("all");d.useEffect(()=>{h()},[x,i]);const h=async()=>{u(!0);try{const s={};if(x!=="all"&&(s.status=x),i==="today")s.startDate=new Date().toISOString().split("T")[0];else if(i==="week"){const p=new Date(Date.now()-6048e5);s.startDate=p.toISOString().split("T")[0]}else if(i==="month"){const p=new Date(Date.now()-2592e6);s.startDate=p.toISOString().split("T")[0]}const{data:a}=await D(s),{data:j}=await _();N(a||[]),f(j)}catch(s){console.error("Error loading RFQ data:",s)}finally{u(!1)}},R=async(s,a)=>{try{await C(s,a),h()}catch(j){console.error("Error updating status:",j)}},y=s=>({new:"bg-blue-500",contacted:"bg-yellow-500",quoted:"bg-purple-500",won:"bg-green-500",lost:"bg-red-500"})[s]||"bg-gray-500",S=s=>({standard:"default",urgent:"secondary",critical:"destructive"})[s]||"default";return b?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"â³"}),e.jsx("p",{className:"text-gray-600",children:"Loading RFQ data..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"RFQ Manager"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track and manage all quote requests"})]}),e.jsx(o,{onClick:h,children:"ðŸ”„ Refresh"})]}),t&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(l,{children:[e.jsx(n,{className:"pb-2",children:e.jsx(r,{className:"text-sm font-medium text-gray-600",children:"Total RFQs"})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:t.total_rfqs}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"All time"})]})]}),e.jsxs(l,{children:[e.jsx(n,{className:"pb-2",children:e.jsx(r,{className:"text-sm font-medium text-gray-600",children:"Today"})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:t.rfqs_today}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Last 24 hours"})]})]}),e.jsxs(l,{children:[e.jsx(n,{className:"pb-2",children:e.jsx(r,{className:"text-sm font-medium text-gray-600",children:"This Week"})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-3xl font-bold text-purple-600",children:t.rfqs_this_week}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Last 7 days"})]})]}),e.jsxs(l,{children:[e.jsx(n,{className:"pb-2",children:e.jsx(r,{className:"text-sm font-medium text-gray-600",children:"Conversion Rate"})}),e.jsxs(c,{children:[e.jsxs("div",{className:"text-3xl font-bold text-orange-600",children:[t.conversion_rate.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Won / Total"})]})]})]}),t&&e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(r,{children:"Status Breakdown"})}),e.jsx(c,{children:e.jsx("div",{className:"flex flex-wrap gap-4",children:Object.entries(t.by_status).map(([s,a])=>e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 px-4 py-2 rounded-lg",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${y(s)}`}),e.jsxs("span",{className:"font-medium capitalize",children:[s,":"]}),e.jsx("span",{className:"font-bold text-lg",children:a})]},s))})})]}),t&&t.by_page&&Object.keys(t.by_page).length>0&&e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(r,{children:"ðŸ“„ RFQs by Source Page"})}),e.jsx(c,{children:e.jsx("div",{className:"space-y-3",children:Object.entries(t.by_page).sort((s,a)=>a[1]-s[1]).map(([s,a])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-32 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${a/t.total_rfqs*100}%`}})}),e.jsx("span",{className:"font-bold text-sm w-12 text-right",children:a})]})]},s))})})]}),t&&t.top_parts.length>0&&e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(r,{children:"ðŸ”§ Top 10 Most Requested Parts"})}),e.jsx(c,{children:e.jsx("div",{className:"space-y-2",children:t.top_parts.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-lg font-bold text-gray-400",children:["#",a+1]}),e.jsx("span",{className:"font-mono text-sm font-medium",children:s.part})]}),e.jsxs(g,{variant:"secondary",children:[s.count," requests"]})]},s.part))})})]}),e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Filter by Status:"}),e.jsx("div",{className:"flex gap-2",children:["all","new","contacted","quoted","won","lost"].map(s=>e.jsx(o,{size:"sm",variant:x===s?"default":"outline",onClick:()=>v(s),children:s==="all"?"All":s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Date Range:"}),e.jsx("div",{className:"flex gap-2",children:["today","week","month","all"].map(s=>e.jsx(o,{size:"sm",variant:i===s?"default":"outline",onClick:()=>w(s),children:s==="today"?"Today":s==="week"?"7 Days":s==="month"?"30 Days":"All Time"},s))})]})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsxs(r,{children:["Recent RFQs (",m.length,")"]})}),e.jsx(c,{children:m.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“­"}),e.jsx("p",{className:"text-lg font-medium",children:"No RFQs found"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your filters"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Customer"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Part Number"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Qty"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Urgency"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Source"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:m.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 text-gray-600",children:[new Date(s.created_at).toLocaleDateString(),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(s.created_at).toLocaleTimeString()})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.email}),s.company&&e.jsx("div",{className:"text-xs text-gray-400",children:s.company})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:s.part_number||"N/A"})}),e.jsx("td",{className:"px-4 py-3 font-medium",children:s.quantity}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(g,{variant:S(s.urgency),children:s.urgency})}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-600",children:s.source_page}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("select",{value:s.status,onChange:a=>R(s.id,a.target.value),className:`px-2 py-1 rounded text-white text-xs font-medium ${y(s.status)}`,children:[e.jsx("option",{value:"new",children:"New"}),e.jsx("option",{value:"contacted",children:"Contacted"}),e.jsx("option",{value:"quoted",children:"Quoted"}),e.jsx("option",{value:"won",children:"Won"}),e.jsx("option",{value:"lost",children:"Lost"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(o,{size:"sm",variant:"outline",onClick:()=>{window.location.href=`mailto:${s.email}?subject=Re: RFQ for ${s.part_number}`},children:"ðŸ“§ Email"})})]},s.id))})]})})})]}),t&&t.by_date.length>0&&e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(r,{children:"ðŸ“ˆ RFQs Trend (Last 30 Days)"})}),e.jsx(c,{children:e.jsx("div",{className:"space-y-2",children:t.by_date.slice(-30).map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-600 w-24",children:s.date}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-6 relative",children:e.jsx("div",{className:"bg-blue-600 h-6 rounded-full flex items-center justify-end pr-2",style:{width:`${Math.max(s.count/Math.max(...t.by_date.map(a=>a.count))*100,10)}%`},children:e.jsx("span",{className:"text-white text-xs font-bold",children:s.count})})})]},s.date))})})]})]})}export{A as default};
